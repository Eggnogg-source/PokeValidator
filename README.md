# Pokemon Comparison Quiz Full Stack Application

Comparisons are personal! This project leans into that with a full-stack Pokémon quiz where players pick which mon reigns supreme within each category. The backend uses Express + PostgreSQL and pulls live stats/abilities from PokéAPI. The frontend (Vite + React) renders rich comparison cards, locks answers, tracks hidden score, and shows a results screen with shareable screenshots. Every pick also unlocks a public comment thread so players can defend their choice.

## Features

### Quiz Flow
- Dedicated start screen explaining the point system (Super Valid → Hell No).
- Categories can contain 2–5 Pokémon (Generations, Legendary groupings, Guardian deities, etc).
- Each Pokémon card shows:
  - Official artwork
  - Full base stats
  - Ability name + effect text
  - Up to three alternate forms (Therian, Altered, etc) when available.
- Choosing a Pokémon:
  - Locks the row, displays result dialogue specific to that mon (Valid, Understandable, No, Hell No…).
  - Reveals a comment form tied to the Pokémon + category.
- “Next Question” button advances sequentially; final step shows a loading screen before results.

### Score & Results
- Hidden point system with five grading tiers:
  - **Super Valid** (+15)
  - **Valid** (+10)
  - **Understandable** (+5)
  - **No** (-10)
  - **Hell No** (-20)
- Final percentage converts to themed verdict text (“YOU ARE… Valid”, “Cool!”, “Eeeh!”, “Way too close, 6 feet bub.”).
- Results screen provides:
  - Screenshot button (html2canvas)
  - Quick restart to rules screen (full reset)
  - Navigation to “Full Results” detail view (per question breakdown).

### Comment System
- Public feed per category/Pokémon with commenter name + timestamp.
- Comments are color-coded based on the Pokémon they support.
- Supports addition & deletion via Express routes; stored in PostgreSQL.
- Frontend auto-refreshes the list after actions.

### Data Integration
- **PokéAPI** fetcher handles:
  - Name variations (incarnate/therian, altered/origin, etc.)
  - Species fallback if direct fetch fails.
  - Ability descriptions via effect entries.
  - Alternate form sprites (dream world, official artwork, fallback to default).
- Server caches nothing (always live) to keep builds simple, but code is structured so caching could be added easily.

## Tech Stack

- **Frontend**: React 18 + Vite, axios, html2canvas.
- **Backend**: Node 20, Express 5, pg, cors, dotenv.
- **Database**: PostgreSQL (tested locally; works with Supabase/Railway/Vercel Postgres).
- **Deployment Targets**: Vercel (frontend + serverless backend) or any Node-compatible host.

## Project Structure
```
Full Stack App/
├── server.js              # Main Express server (serves API + static frontend)
├── package.json            # Root package.json with all dependencies
├── vercel.json             # Vercel deployment configuration
├── backend/
│   ├── routes/
│   │   ├── quiz.js         # Quiz data + PokéAPI proxy
│   │   └── comments.js     # Comment CRUD (now includes deletion)
│   ├── models/
│   │   └── db.js           # Pool + helpers (init schema, comments, etc.)
│   ├── seeds/
│   │   ├── quizData.js     # Dialogue + scoring per Pokémon
│   │   └── seedDatabase.js
│   └── scripts/
│       ├── createDatabase.js
│       └── updateSchema.js # Recreates tables with 5-Pokémon support
├── frontend/
│   ├── src/
│   │   ├── services/api.js
│   │   ├── App.jsx
│   │   ├── components/
│   │   │   ├── StartScreen.jsx
│   │   │   ├── QuizInterface.jsx
│   │   │   ├── PokemonOption.jsx
│   │   │   ├── FeedbackDisplay.jsx
│   │   │   ├── CommentSection.jsx
│   │   │   ├── ResultsScreen.jsx
│   │   │   └── FullResultsView.jsx
│   │   └── ...
│   ├── dist/               # Built frontend (generated by npm run build)
│   └── package.json        # Frontend package.json (for Vite build)
├── README.md
├── TESTING_GUIDE.md
└── .gitignore
```

## Setup & Environment

### Prerequisites
- Node.js 18+ (project uses fetch API in Node)
- PostgreSQL instance
- npm (or pnpm/yarn with adjusted commands)

### Installation
```bash
# Install all dependencies (root package.json includes both backend and frontend deps)
npm install

# Create .env file from example (combines backend and frontend env vars)
# Copy backend/env.example and frontend/env.example into a root .env file
```

Root `.env` should include:
```
DATABASE_URL=postgresql://USERNAME:PASSWORD@localhost:5432/pokemon_quiz
PORT=5000
# Comma-separated list (leave blank to allow any origin during local dev)
CORS_ALLOWED_ORIGINS=http://localhost:5173,https://poke-validator.vercel.app
# Frontend API config (optional - defaults to /api in production)
VITE_API_URL=
VITE_DEV_API_URL=http://localhost:5000
```

### Initialize Database
```bash
npm run update-schema   # Drops/recreates quiz_questions + comments with 5-slot schema
npm run seed            # Inserts all categories + dialogue
```

### Development
```bash
# Option 1: Run full-stack server (serves API + built frontend)
npm run build           # Build frontend first
npm start               # Start server on port 5000

# Option 2: Run frontend dev server with hot reload (proxies /api to backend)
cd frontend
npm run dev             # Vite dev server on http://localhost:5173
# In another terminal, run: npm start (from root) for backend API
```

## Testing Workflow
Please see `TESTING_GUIDE.md` for a command-by-command walkthrough. Highlights:
1. Create DB + run `npm run update-schema`
2. `npm run seed` to insert 23 questions (Legendaries included)
3. `npm run build` to build frontend
4. `npm start` to run full-stack server (API + frontend on port 5000)
5. Manual QA: quiz flow, comment add/delete, results, screenshot.

## Deployment Notes

### Vercel Deployment
- **Single unified deployment**: The app uses a single `server.js` that serves both API routes and static frontend files.
- **Build process**: 
  1. Vercel runs `npm install` (detects root `package.json` automatically)
  2. Vercel runs `npm run build` (builds frontend to `frontend/dist`)
  3. Vercel deploys `server.js` as a serverless function
  4. All routes (`/api/*` and `/*`) are handled by `server.js`
- **Environment variables**: Set in Vercel dashboard:
  - `DATABASE_URL` (required)
  - `CORS_ALLOWED_ORIGINS` (optional, comma-separated)
  - `VITE_API_URL` (optional, defaults to `/api` in production)
- **Database setup**: After first deployment, connect to your database and run:
  ```bash
  npm run update-schema
  npm run seed
  ```

### Local Production Preview
```bash
npm run build    # Build frontend
npm start        # Run server (serves API + static files on port 5000)
```

### Other Hosts
The app can run on any Node.js host. The `server.js` serves both API and frontend, so no separate frontend deployment is needed.

## Environment Variables

All environment variables are set at the root level in a `.env` file:

| Variable                | Purpose                                     | Default                    |
|-------------------------|---------------------------------------------|----------------------------|
| `DATABASE_URL`          | PostgreSQL connection string                | (required)                 |
| `PORT`                  | Express port                                | 5000                       |
| `CORS_ALLOWED_ORIGINS`  | Whitelist domains for browser requests      | (optional, comma-separated)|
| `VITE_API_URL`          | Base URL for API requests in production     | `/api` (relative path)     |
| `VITE_DEV_API_URL`      | Vite dev-server proxy target                | `http://localhost:5000`   |

## License
ISC

